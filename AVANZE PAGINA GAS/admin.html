<!DOCTYPE html>



<html lang="es">




<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de AdministraciÃ³n - IntoxiGas</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/estilo.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>





    <style>
        .card-dashboard {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .card-dashboard:hover {
            transform: translateY(-5px);
        }

        .bg-gradient-orange {
            background: linear-gradient(45deg, #ff6b00, #ff8e33);
            color: white;
        }

        .bg-gradient-blue {
            background: linear-gradient(45deg, #002f6c, #0056b3);
            color: white;
        }

        .bg-gradient-green {
            background: linear-gradient(45deg, #198754, #20c997);
            color: white;
        }
    </style>
</head>

<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold text-warning" href="#">
                <i class="fas fa-user-shield"></i> IntoxiGas ADMIN
            </a>
            <div class="d-flex">
                <span class="navbar-text text-white me-3">
                    Hola, Administrador
                </span>
                <button class="btn btn-outline-light btn-sm" onclick="cerrarSesion()">
                    <i class="fas fa-sign-out-alt"></i> Salir
                </button>
            </div>
        </div>
    </nav>

    <div class="container">

        <h3 class="mb-4 text-secondary">ðŸ“Š Resumen del Negocio</h3>
        <div class="row mb-5">
            <div class="col-md-4">
                <div class="card card-dashboard bg-gradient-blue p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="mb-0">Pedidos Totales</h5>
                            <h2 class="fw-bold" id="totalPedidos">0</h2>
                        </div>
                        <i class="fas fa-shopping-cart fa-3x opacity-50"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card card-dashboard bg-gradient-green p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="mb-0">Ganancias</h5>
                            <h2 class="fw-bold" id="totalGanancias">$0</h2>
                        </div>
                        <i class="fas fa-dollar-sign fa-3x opacity-50"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card card-dashboard bg-gradient-orange p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="mb-0">Pendientes</h5>
                            <h2 class="fw-bold" id="totalPendientes">0</h2>
                        </div>
                        <i class="fas fa-clock fa-3x opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow-sm mb-5">
            <div class="card-header bg-white py-3">
                <h5 class="mb-0 text-secondary"><i class="fas fa-list"></i> Ãšltimos Pedidos</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>#ID</th>
                                <th>Fecha</th>
                                <th>Cliente / DirecciÃ³n</th>
                                <th>Productos</th>
                                <th>Total</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaPedidos">
                        </tbody>
                    </table>
                </div>
                <div id="mensajeVacio" class="text-center text-muted p-4 d-none">
                    No hay pedidos registrados todavÃ­a.
                </div>
            </div>
        </div>

    </div>

    <script>
        // 1. SEGURIDAD: Verificar si es Admin
        let rol = localStorage.getItem("rol");
        if (rol !== "admin") {
            window.location.href = "login.html"; 
        }

        // 2. CARGAR PEDIDOS
        function cargarDatos() {
            let pedidos = JSON.parse(localStorage.getItem("pedidos")) || [];
            let tabla = document.getElementById("tablaPedidos");
            let mensajeVacio = document.getElementById("mensajeVacio");
            let contadorGanancias = 0;
            let contadorPendientes = 0;

            tabla.innerHTML = ""; // Limpiamos la tabla antes de llenarla

            if (pedidos.length === 0) {
                // Si no hay pedidos, mostramos el mensaje de "VacÃ­o"
                mensajeVacio.classList.remove("d-none");
            } else {
                mensajeVacio.classList.add("d-none");

                // BUCLE FOR 
                // Recorremos los pedidos desde el ÃšLTIMO hasta el PRIMERO (i--)
                for (let i = pedidos.length - 1; i >= 0; i--) {
                    let pedidoActual = pedidos[i];

                    // CALCULAR EL TOTAL DEL PEDIDO 
                    let totalPedido = 0;
                    let listaProductosHTML = ""; 

                    for (let j = 0; j < pedidoActual.productos.length; j++) {
                        let producto = pedidoActual.productos[j];
                        totalPedido = totalPedido + producto.precio;
                        listaProductosHTML = listaProductosHTML + "<div>â€¢ " + producto.nombre + "</div>";
                    }

                    // Sumamos a las ganancias totales de la tienda
                    contadorGanancias = contadorGanancias + totalPedido;

                    // Revisamos el estado
                    if (pedidoActual.estado === undefined) {
                        pedidoActual.estado = "Pendiente";
                    }

                    let colorEstado = "bg-warning text-dark"; 
                    let botonAccion = ""; 

                    if (pedidoActual.estado === "Pendiente") {
                        contadorPendientes = contadorPendientes + 1; 
                        botonAccion = '<button class="btn btn-sm btn-success" onclick="cambiarEstado(' + i + ', \'Entregado\')">Marcar Entregado</button>';
                    } else {
                        colorEstado = "bg-success"; 
                        botonAccion = '<button class="btn btn-sm btn-warning" onclick="cambiarEstado(' + i + ', \'Pendiente\')">Deshacer</button>';
                    }

                    // DIBUJAR LA FILA EN LA TABLA
                    // Usamos comillas invertidas ` ` para poder meter variables dentro
                    let fila = `
                        <tr>
                            <td>${i + 1}</td>
                            <td>${pedidoActual.fecha}</td>
                            <td>
                                <strong>${pedidoActual.direccion.nombre}</strong><br>
                                ${pedidoActual.direccion.direccion}
                            </td>
                            <td>${listaProductosHTML}</td>
                            <td>$${totalPedido}</td>
                            <td><span class="badge ${colorEstado}">${pedidoActual.estado}</span></td>
                            <td>
                                ${botonAccion}
                                <button class="btn btn-sm btn-danger" onclick="borrarPedido(${i})">Borrar</button>
                            </td>
                        </tr>
                    `;
                    tabla.innerHTML += fila;
                }
            }

            // Actualizar los numeritos de arriba 
            document.getElementById("totalPedidos").textContent = pedidos.length;
            document.getElementById("totalGanancias").textContent = "$" + contadorGanancias;
            document.getElementById("totalPendientes").textContent = contadorPendientes;
        }

        // CAMBIAR ESTADO
        function cambiarEstado(posicion, nuevoEstado) {
            let pedidos = JSON.parse(localStorage.getItem("pedidos"));
            pedidos[posicion].estado = nuevoEstado; // Cambiamos el texto
            localStorage.setItem("pedidos", JSON.stringify(pedidos)); // Guardamos
            cargarDatos(); 
        }

        // BORRAR PEDIDO
        function borrarPedido(posicion) {
            let confirmacion = confirm("Â¿EstÃ¡s seguro de borrar este pedido?");

            if (confirmacion === true) {
                let pedidos = JSON.parse(localStorage.getItem("pedidos"));
                // .splice quita 1 elemento en la posiciÃ³n indicada
                pedidos.splice(posicion, 1);
                localStorage.setItem("pedidos", JSON.stringify(pedidos));
                cargarDatos();
            }
        }

        // CERRAR SESIÃ“N
        function cerrarSesion() {
            localStorage.removeItem("rol");
            window.location.href = "login.html";
        }

        // Ejecutar la funciÃ³n al iniciar la pÃ¡gina
        cargarDatos();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>